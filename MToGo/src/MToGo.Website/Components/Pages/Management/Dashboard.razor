@page "/management"
@inject AuthService Auth
@inject NavigationManager Navigation
@inject CultureService CultureService
@inject ILocalizerService L
@implements IDisposable
@rendermode InteractiveServer

<PageTitle>@L["Pages.Management.Dashboard.PageTitle"]</PageTitle>

<div class="container mt-4">
    @if (!isInitialized)
    {
        <div class="text-center">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">@L["Pages.Management.Dashboard.Loading"]</span>
            </div>
        </div>
    }
    else if (!Auth.IsManagement)
    {
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="alert alert-warning">
                    <h5 class="alert-heading">@L["Pages.Management.Dashboard.AccessDeniedTitle"]</h5>
                    <p class="mb-0">@L["Pages.Management.Dashboard.LoginRequired"] <a href="/management/login">@L["Pages.Management.Dashboard.LoginLink"]</a></p>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>@L["Pages.Management.Dashboard.Title"]</h2>
                    <span class="badge bg-dark fs-6">@L.GetString("Pages.Management.Dashboard.WelcomeUser", Auth.Name ?? "Admin")</span>
                </div>
            </div>
        </div>

        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <div class="flex-grow-1">
                            <h5 class="card-title">@L["Pages.Management.Dashboard.CreateAgentTitle"]</h5>
                            <p class="card-text">@L["Pages.Management.Dashboard.CreateAgentDescription"]</p>
                        </div>
                        <a href="/management/agents/create" class="btn btn-primary align-self-start mt-auto">@L["Pages.Management.Dashboard.CreateAgentButton"]</a>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <div class="flex-grow-1">
                            <h5 class="card-title">@L["Pages.Management.Dashboard.CreatePartnerTitle"]</h5>
                            <p class="card-text">@L["Pages.Management.Dashboard.CreatePartnerDescription"]</p>
                        </div>
                        <a href="/management/partners/create" class="btn btn-primary align-self-start mt-auto">@L["Pages.Management.Dashboard.CreatePartnerButton"]</a>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <div class="flex-grow-1">
                            <h5 class="card-title">@L["Pages.Management.Dashboard.MetricsTitle"]</h5>
                            <p class="card-text">@L["Pages.Management.Dashboard.MetricsDescription"]</p>
                        </div>
                        <a href="/management" class="btn btn-primary align-self-start mt-auto">@L["Pages.Management.Dashboard.ViewMetricsButton"]</a>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <div class="flex-grow-1">
                            <h5 class="card-title">@L["Pages.Management.Dashboard.ViewReviewsTitle"]</h5>
                            <p class="card-text">@L["Pages.Management.Dashboard.ViewReviewsDescription"]</p>
                        </div>
                        <a href="/management/reviews" class="btn btn-primary align-self-start mt-auto">@L["Pages.Management.Dashboard.ViewReviewsButton"]</a>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100 border-warning">
                    <div class="card-body d-flex flex-column">
                        <div class="flex-grow-1">
                            <h5 class="card-title"><i class="bi bi-trophy text-warning"></i> @L["Pages.Management.Dashboard.AgentBonusTitle"]</h5>
                            <p class="card-text">@L["Pages.Management.Dashboard.AgentBonusDescription"]</p>
                        </div>
                        <a href="/management/agent-bonus" class="btn btn-warning align-self-start mt-auto">@L["Pages.Management.Dashboard.AgentBonusButton"]</a>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100 border-success">
                    <div class="card-body d-flex flex-column">
                        <div class="flex-grow-1">
                            <h5 class="card-title"><i class="bi bi-graph-up text-success"></i> @L["Pages.Management.Dashboard.GrafanaTitle"]</h5>
                            <p class="card-text">@L["Pages.Management.Dashboard.GrafanaDescription"]</p>
                        </div>
                        <a href="http://localhost:3000" target="_blank" class="btn btn-success align-self-start mt-auto">
                            <i class="bi bi-box-arrow-up-right me-1"></i>@L["Pages.Management.Dashboard.OpenGrafanaButton"]
                        </a>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100 border-info">
                    <div class="card-body d-flex flex-column">
                        <div class="flex-grow-1">
                            <h5 class="card-title"><i class="bi bi-shield-check text-info"></i> @L["Pages.Management.Dashboard.AuditLogsTitle"]</h5>
                            <p class="card-text">@L["Pages.Management.Dashboard.AuditLogsDescription"]</p>
                        </div>
                        <a href="/management/audit-logs" class="btn btn-info align-self-start mt-auto">@L["Pages.Management.Dashboard.ViewAuditLogsButton"]</a>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-100 border-secondary">
                    <div class="card-body d-flex flex-column">
                        <div class="flex-grow-1">
                            <h5 class="card-title"><i class="bi bi-terminal text-secondary"></i> @L["Pages.Management.Dashboard.SystemLogsTitle"]</h5>
                            <p class="card-text">@L["Pages.Management.Dashboard.SystemLogsDescription"]</p>
                        </div>
                        <a href="/management/system-logs" class="btn btn-secondary align-self-start mt-auto">@L["Pages.Management.Dashboard.ViewSystemLogsButton"]</a>
                    </div>
                </div>
            </div>
            <!-- Add more cards here as needed - they will automatically wrap to new rows -->
        </div>
    }
</div>

@code {
    private bool isInitialized;

    protected override void OnInitialized()
    {
        CultureService.OnChange += OnCultureChanged;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await Auth.InitializeAsync();
            isInitialized = true;
            StateHasChanged();
        }
    }

    private void OnCultureChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        CultureService.OnChange -= OnCultureChanged;
    }
}
