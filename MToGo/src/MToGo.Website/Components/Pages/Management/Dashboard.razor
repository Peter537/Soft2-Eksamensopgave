@page "/management"
@inject AuthService Auth
@inject NavigationManager Navigation
@inject CultureService CultureService
@inject ILocalizerService L
@implements IDisposable
@rendermode InteractiveServer

<PageTitle>@L["Pages.Management.Dashboard.PageTitle"]</PageTitle>

<div class="container mt-4">
    @if (!isInitialized)
    {
        <div class="text-center">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    }
    else if (!Auth.IsManagement)
    {
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="alert alert-warning">
                    <h5 class="alert-heading">@L["Pages.Management.Dashboard.AccessDeniedTitle"]</h5>
                    <p class="mb-0">@L["Pages.Management.Dashboard.LoginRequired"] <a href="/management/login">@L["Pages.Management.Dashboard.LoginLink"]</a></p>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>@L["Pages.Management.Dashboard.Title"]</h2>
                    <span class="badge bg-dark fs-6">@L.GetString("Pages.Management.Dashboard.WelcomeUser", Auth.Name ?? "Admin")</span>
                </div>
            </div>
        </div>
    }
</div>

@code {
    private bool isInitialized;

    protected override void OnInitialized()
    {
        CultureService.OnChange += OnCultureChanged;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await Auth.InitializeAsync();
            isInitialized = true;
            StateHasChanged();
        }
    }

    private void OnCultureChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        CultureService.OnChange -= OnCultureChanged;
    }
}
